<!DOCTYPE html>
<html>
  <head>
    <title>Acebook</title>
    <%= csrf_meta_tags %>
    <%= stylesheet_link_tag 'https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css' %>
    <%= stylesheet_link_tag    'application', media: 'all' %>
    <%= javascript_include_tag 'application' %>
  </head>
  <body>
  <div class = "container">
    <nav class="text-right">
     <%= link_to "8BOOK", posts_url, class: "btn btn-light btn-md float-start" %>
      <%= link_to "Home", posts_url, class: "btn btn-md text-white" %>
      <% link_to "New Post", new_post_url, class: "navbar-link" %>
      <% if session[:user_id] %>
          <%= link_to "Log Out", logout_path, method: :delete,  class: "btn btn-danger btn-md text-white" %>
      <% else %>
        <%= link_to "Sign Up", new_user_path, class: "btn btn-danger btn-md text-white" %>
        <%= link_to "Log In", log_in_path, class: "btn btn-danger btn-md text-white" %>
      <% end %>
    </nav>

    <%= yield %>
  </div>

  <script>
    // let containerScrollTops = {};

    // addEventListener("turbo:click", () => {
    //   document
    //     .querySelectorAll("[save-scroll]")
    //     .forEach((ele) => {
    //       containerScrollTops[ele.dataset.turboPreserveScrollContainer] =
    //         ele.scrollTop;
    //     });
    // });

    // addEventListener("turbo:load", () => {
    //   document
    //     .querySelectorAll("[save-scroll]")
    //     .forEach((ele) => {
    //       const containerScrollTop =
    //         containerScrollTops[ele.dataset.turboPreserveScrollContainer];
    //       if (containerScrollTop) ele.scrollTo(0, containerScrollTop);
    //     });

    //   containerScrollTops = {};
    // });

    class ScrollPosition {
      save() {
        document.body.dataset.scrollPosition = JSON.stringify([window.scrollX, window.scrollY]);
      }

      restore() {
        const scrollPosition = JSON.parse(document.body.dataset.scrollPosition || '[]');
        if (scrollPosition.length > 0) {
          window.scrollTo(...scrollPosition);
        }
        delete document.body.dataset.scrollPosition;
      }
    }

    const scrollPosition = new ScrollPosition();

    document.addEventListener('turbo:before-cache', function (_event) {
      scrollPosition.save();
    });

    document.addEventListener('turbo:load', function (_event) {
      scrollPosition.restore();
    });
  </script>

  </body>
</html>
